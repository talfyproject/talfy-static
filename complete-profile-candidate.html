<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Complete Candidate Profile - Talfy</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Segoe+UI&display=swap"/>
  <style>
    /* (Stili esistenti invariati) */
  </style>
</head>
<body>

<header>
  <nav>
    <div><strong>Talfy</strong></div>
    <div>
      <a href="about.html">About Us</a>
      <a href="contact.html">Contact</a>
      <a href="pricing.html">Pricing</a>
      <a href="talfy-for-talent.html">For Talent</a>
      <a href="talfy-for-company.html">For Company</a>
      <a href="login.html">Login</a>
      <a href="register.html">Register</a>
    </div>
  </nav>
</header>

<div class="container">
  <h2>Complete Your Candidate Profile</h2>

  <form id="candidateForm">
    <!-- Avatar and Photo Selection -->
    <!-- Basic Info, Job Titles, Industries, Tools, Languages, Education -->
    <!-- Tutti i campi come già presenti nella tua versione -->

    <button type="submit">Save Profile</button>
  </form>
</div>

<footer class="footer">
  <div class="footer-center">&copy; 2025 Talfy. All rights reserved.</div>
  <div class="footer-right">
    <a href="/privacy.html">Privacy</a> · <a href="/terms.html">Terms</a>
  </div>
</footer>

<script>
  document.getElementById("candidateForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const form = e.target;
    const user_id = localStorage.getItem("user_id");

    if (!user_id) {
      alert("User ID missing. Please register again.");
      return;
    }

    const first_name = form.first_name.value.trim();
    const last_name = form.last_name.value.trim();
    const display_name = `${first_name} ${last_name.charAt(0)}.`;

    const avatarRadio = form.querySelector('input[name="avatar"]:checked');
    const avatar = avatarRadio ? (avatarRadio.value === "female"
      ? "img/avatar-female.png"
      : "img/avatar-male.png") : "";

    const current_job = Array.from(form.querySelectorAll('input[name="job_titles"]:checked')).map(cb => cb.value).join(", ");
    const experience_years = 0;
    const salary_range = "-";
    const sector = Array.from(form.querySelectorAll('input[name="industries"]:checked')).map(cb => cb.value).join(", ");
    const tools = Array.from(form.querySelectorAll('input[name="tools"]:checked')).map(cb => cb.value).join(", ");

    const payload = {
      user_id,
      display_name,
      current_job,
      experience_years,
      salary_range,
      sector,
      tools,
      avatar
    };

    try {
      const res = await fetch("/save-candidate-profile", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
      });

      if (res.ok) {
        window.location.href = "/candidates.html";
      } else {
        const error = await res.json();
        alert("Error: " + (error.error || "Unknown"));
      }
    } catch (err) {
      console.error(err);
      alert("Connection error");
    }
  });
</script>

</body>
</html>
