<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Edit Candidate Profile – Talfy</title>
  <link rel="stylesheet" href="style.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <script>
    function toggleMenu() {
      document.getElementById("mobileMenu").classList.toggle("active");
    }

    async function loadProfileData() {
      const userId = localStorage.getItem("user_id");
      const userType = localStorage.getItem("user_type");
      if (!userId || userType !== "candidate") {
        window.location.href = "/login.html";
        return;
      }

      try {
        const res = await fetch("https://talfy-backend.onrender.com/api/candidate/" + userId);
        const data = await res.json();

        document.getElementById("first_name").value = data.first_name || "";
        document.getElementById("last_name").value = data.last_name || "";
        document.getElementById("display_name").value = data.display_name || "";
        document.getElementById("current_job").value = data.current_job || "";
        document.getElementById("experience_years").value = data.experience_years || "";
        document.getElementById("salary_range").value = data.salary_range || "";
        document.getElementById("native_language").val<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Edit Candidate Profile – Talfy</title>
  <link rel="stylesheet" href="style.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <script>
    function toggleMenu() {
      document.getElementById("mobileMenu").classList.toggle("active");
    }

    async function loadProfileData() {
      const userId = localStorage.getItem("user_id");
      const userType = localStorage.getItem("user_type");
      if (!userId || userType !== "candidate") {
        window.location.href = "/login.html";
        return;
      }

      try {
        const res = await fetch("https://talfy-backend.onrender.com/api/candidate/" + userId);
        const data = await res.json();

        if (data.error) {
          alert("Profile not found.");
          return;
        }

        document.getElementById("display_name").value = data.display_name || "";
        document.getElementById("current_job").value = data.current_job || "";
        document.getElementById("experience_years").value = data.experience_years || "";
        document.getElementById("salary_range").value = data.salary_range || "";

        if (data.tools) {
          const toolsArray = data.tools.split(",").map(t => t.trim());
          toolsArray.forEach(tool => {
            const checkbox = document.querySelector(`input[name="tools[]"][value="${tool}"]`);
            if (checkbox) checkbox.checked = true;
          });
        }

        if (data.sector) {
          const sectorArray = data.sector.split(",").map(s => s.trim());
          sectorArray.forEach(sector => {
            const checkbox = document.querySelector(`input[name="sector[]"][value="${sector}"]`);
            if (checkbox) checkbox.checked = true;
          });
        }

        if (data.avatar) {
          const radio = document.querySelector(`input[name="avatar"][value="${data.avatar}"]`);
          if (radio) radio.checked = true;
        }

      } catch (err) {
        alert("Error loading profile data.");
        console.error(err);
      }
    }

    async function submitForm(event) {
      event.preventDefault();

      const form = document.getElementById("profileForm");
      const formData = new FormData(form);
      const userId = localStorage.getItem("user_id");

      const json = {};
      formData.forEach((value, key) => {
        if (key.endsWith("[]")) {
          const trimmedKey = key.replace("[]", "");
          if (!json[trimmedKey]) json[trimmedKey] = [];
          json[trimmedKey].push(value);
        } else {
          json[key] = value;
        }
      });

      try {
        const res = await fetch("https://talfy-backend.onrender.com/api/update-candidate/" + userId, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(json)
        });

        if (res.ok) {
          alert("Profile updated successfully!");
          window.location.href = "/candidate.html?id=" + userId;
        } else {
          alert("Failed to update profile.");
        }
      } catch (err) {
        alert("Server error.");
      }
    }

    window.onload = loadProfileData;
  </script>
</head>
<body>
  <header class="header">
    <a href="/index.html" class="logo">talfy</a>
    <nav class="nav">
      <a href="/pricing.html">Pricing</a>
      <a href="/about.html">About us</a>
      <a href="/contact.html">Contact</a>
      <a href="#" onclick="logout()" id="logoutBtn">Logout</a>
    </nav>
    <button class="hamburger" onclick="toggleMenu()"><span></span><span></span><span></span></button>
    <div class="mobile-menu" id="mobileMenu">
      <a href="/pricing.html">Pricing</a>
      <a href="/about.html">About us</a>
      <a href="/contact.html">Contact</a>
      <a href="#" onclick="logout()">Logout</a>
    </div>
  </header>

  <main class="main">
    <h1>Edit Your Candidate Profile</h1>
    <form id="profileForm" onsubmit="submitForm(event)">
      <label>Display Name: <input type="text" id="display_name" name="display_name"/></label>
      <label>Current Job: <input type="text" id="current_job" name="current_job"/></label>
      <label>Years of Experience: <input type="number" id="experience_years" name="experience_years"/></label>
      <label>Salary Range: <input type="text" id="salary_range" name="salary_range"/></label>

      <fieldset>
        <legend>Sectors:</legend>
        <label><input type="checkbox" name="sector[]" value="Banking"/> Banking</label>
        <label><input type="checkbox" name="sector[]" value="Insurance"/> Insurance</label>
        <label><input type="checkbox" name="sector[]" value="Consulting"/> Consulting</label>
      </fieldset>

      <fieldset>
        <legend>Tools Known:</legend>
        <label><input type="checkbox" name="tools[]" value="SAP"/> SAP</label>
        <label><input type="checkbox" name="tools[]" value="Excel"/> Excel</label>
        <label><input type="checkbox" name="tools[]" value="Power BI"/> Power BI</label>
      </fieldset>

      <fieldset>
        <legend>Choose Avatar:</legend>
        <label><input type="radio" name="avatar" value="male"/> Male Avatar</label>
        <label><input type="radio" name="avatar" value="female"/> Female Avatar</label>
      </fieldset>

      <button type="submit">Save Profile</button>
    </form>
  </main>

  <footer class="footer">
    <div class="footer-center">&copy; 2025 Talfy. All rights reserved.</div>
    <div class="footer-right">
      <a href="/privacy.html">Privacy</a> · <a href="/terms.html">Terms</a>
    </div>
  </footer>
</body>
</html>
